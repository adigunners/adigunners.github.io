<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug - Data Fetching Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
      }
      .test-result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîç Data Fetching Debug Tool</h1>
    <p>This tool will test if your JSON files are loading correctly.</p>
    <div id="results"></div>
    <script>
      const resultsDiv = document.getElementById('results');
      function addResult(message, type = 'info') {
        const div = document.createElement('div');
        div.className = `test-result ${type}`;
        // If message is a Node, append directly; else, treat as text
        if (message instanceof Node) {
          div.appendChild(message);
        } else {
          div.textContent = message;
        }
        resultsDiv.appendChild(div);
      }
      // Helper to safely render a label and JSON object
      function addLabelAndJSON(label, obj, type = 'info') {
        const wrapper = document.createElement('div');
        const labelEl = document.createElement('div');
        labelEl.textContent = label;
        labelEl.style.fontWeight = 'bold';
        const pre = document.createElement('pre');
        pre.textContent = formatJSON(obj);
        wrapper.appendChild(labelEl);
        wrapper.appendChild(pre);
        addResult(wrapper, type);
      }
      function formatJSON(obj) {
        return JSON.stringify(obj, null, 2);
      }
      async function testDataFetching() {
        addResult('üöÄ Starting data fetch tests...', 'info');
        // Test 1: League Stats
        try {
          addResult('üìä Testing league_stats.json...', 'info');
          const leagueResponse = await fetch('data/league_stats.json?cache=' + new Date().getTime());
          if (!leagueResponse.ok) {
            throw new Error(`HTTP ${leagueResponse.status}: ${leagueResponse.statusText}`);
          }
          const leagueData = await leagueResponse.json();
          addResult('‚úÖ League stats loaded successfully!', 'success');
          addLabelAndJSON('League Stats Data:', leagueData, 'success');
        } catch (error) {
          addResult('‚ùå Failed to load league_stats.json: ' + error.message, 'error');
        }
        // Test 2: Winner Stats (Live)
        try {
          addResult('üèÜ Testing winner_stats.json...', 'info');
          const winnerResponse = await fetch('data/winner_stats.json?cache=' + new Date().getTime());
          if (!winnerResponse.ok) {
            throw new Error(`HTTP ${winnerResponse.status}: ${winnerResponse.statusText}`);
          }
          const winnerData = await winnerResponse.json();
          addResult('‚úÖ Winner stats loaded successfully!', 'success');
          addLabelAndJSON(
            'Winner Stats Summary:',
            {
              lastUpdated: winnerData.lastUpdated,
              totalWinners: Array.isArray(winnerData.winners) ? winnerData.winners.length : 0,
              summary: winnerData.summary,
            },
            'success'
          );
        } catch (error) {
          addResult('‚ùå Failed to load winner_stats.json: ' + error.message, 'error');
        }
        // Test 3: Test Winner Stats
        try {
          addResult('üß™ Testing test_winner_stats.json...', 'info');
          const testWinnerResponse = await fetch(
            'data/test_winner_stats.json?cache=' + new Date().getTime()
          );
          if (!testWinnerResponse.ok) {
            throw new Error(`HTTP ${testWinnerResponse.status}: ${testWinnerResponse.statusText}`);
          }
          const testWinnerData = await testWinnerResponse.json();
          addResult('‚úÖ Test winner stats loaded successfully!', 'success');
          addLabelAndJSON(
            'Test Winner Stats Summary:',
            {
              lastUpdated: testWinnerData.lastUpdated,
              totalWinners: Array.isArray(testWinnerData.winners)
                ? testWinnerData.winners.length
                : 0,
              summary: testWinnerData.summary,
              testMode: testWinnerData.testMode,
            },
            'success'
          );
        } catch (error) {
          addResult('‚ùå Failed to load test_winner_stats.json: ' + error.message, 'error');
        }
        // Test 4: Browser Environment Info
        addResult('üåê Browser Environment Info:', 'info');
        addLabelAndJSON(
          'Browser Environment:',
          {
            userAgent: navigator.userAgent,
            location: {
              protocol: window.location.protocol,
              hostname: window.location.hostname,
              port: window.location.port,
              pathname: window.location.pathname,
            },
            currentTime: new Date().toISOString(),
            timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          },
          'info'
        );
        addResult('üèÅ All tests completed!', 'info');
      }
      // Run tests when page loads
      document.addEventListener('DOMContentLoaded', testDataFetching);
    </script>
  </body>
</html>
