<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Font Loading Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .warning {
        background-color: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .test-element {
        margin: 10px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
      }
      .poppins-test {
        font-family: 'Poppins', sans-serif;
      }
      .fa-test {
        font-family: 'Font Awesome 6 Free';
      }
      pre {
        background: #f1f3f4;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
    </style>

    <!-- Include same font links as main site -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
      crossorigin="anonymous"
      onerror="console.warn('Google Fonts failed to load'); document.body.classList.add('poppins-fallback', 'external-resources-failed'); if(document.getElementById('fallback-css')) document.getElementById('fallback-css').disabled = false;"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha384-t1nt8BQoYMLFN5p42tRAtuAAFQaCQODekUVeKKZrEnEyp4H2R0RHFz0KWpmj7i8g"
      crossorigin="anonymous"
      onerror="console.warn('Font Awesome failed to load'); document.body.classList.add('external-resources-failed'); if(document.getElementById('fallback-css')) document.getElementById('fallback-css').disabled = false;"
    />

    <!-- Fallback CSS -->
    <link rel="stylesheet" id="fallback-css" disabled />
    <style id="fallback-styles">
      /* Fallback styles when external resources fail */
      .external-resources-failed .fas,
      .external-resources-failed .far,
      .external-resources-failed .fab {
        /* Fallback for Font Awesome icons */
        font-family: Arial, sans-serif;
      }
      .external-resources-failed .fas::before {
        content: 'üî∂';
      }
      .poppins-fallback * {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      }
    </style>
  </head>
  <body>
    <h1>Font Loading System Test</h1>

    <div class="test-section" id="integrity-test">
      <h2>‚úÖ Integrity Hash Test</h2>
      <p><strong>Status:</strong> <span id="integrity-status">Testing...</span></p>
      <p>Google Fonts integrity hash has been removed to prevent validation failures.</p>
    </div>

    <div class="test-section" id="font-loading-test">
      <h2>Font Loading Test</h2>
      <p><strong>Status:</strong> <span id="font-status">Testing...</span></p>

      <div class="test-element">
        <h3>Poppins Font Test</h3>
        <p class="poppins-test">This text should be in Poppins font if loaded correctly.</p>
        <div id="poppins-result"></div>
      </div>

      <div class="test-element">
        <h3>Font Awesome Test</h3>
        <p>Font Awesome icon: <i class="fas fa-users fa-test"></i></p>
        <div id="fontawesome-result"></div>
      </div>
    </div>

    <div class="test-section" id="fallback-test">
      <h2>Fallback System Test</h2>
      <p><strong>Status:</strong> <span id="fallback-status">Testing...</span></p>
      <div id="fallback-details"></div>
    </div>

    <div class="test-section" id="error-handling-test">
      <h2>Error Handling Test</h2>
      <p><strong>Status:</strong> <span id="error-status">Testing...</span></p>
      <button onclick="testErrorHandling()">Test Error Handlers</button>
      <div id="error-results"></div>
    </div>

    <div class="test-section">
      <h2>Console Output</h2>
      <p>Check browser console for detailed logs.</p>
      <button onclick="showConsoleMessages()">Show Test Results</button>
      <pre id="console-output"></pre>
    </div>

    <script>
      // Test results storage
      const testResults = {
        integrity: false,
        poppinsLoaded: false,
        fontAwesomeLoaded: false,
        fallbackEnabled: false,
        errorHandlers: false,
      };

      // Console message capture
      const consoleMessages = [];
      const originalConsole = {
        log: console.log,
        warn: console.warn,
        error: console.error,
        info: console.info,
      };

      ['log', 'warn', 'error', 'info'].forEach((method) => {
        console[method] = function (...args) {
          consoleMessages.push({ type: method, message: args.join(' '), time: new Date() });
          originalConsole[method].apply(console, args);
        };
      });

      // Test functions
      function testIntegrity() {
        console.info('‚úÖ Integrity Test: Google Fonts integrity attribute removed');
        testResults.integrity = true;
        document.getElementById('integrity-status').textContent = 'Passed';
        document.getElementById('integrity-test').classList.add('success');
      }

      function testFontLoading() {
        // Test Poppins
        const testPoppins = document.createElement('div');
        testPoppins.style.fontFamily = 'Poppins, serif';
        testPoppins.style.position = 'absolute';
        testPoppins.style.left = '-9999px';
        testPoppins.innerHTML = 'test';
        document.body.appendChild(testPoppins);

        setTimeout(() => {
          const poppinsStyle = window.getComputedStyle(testPoppins);
          const poppinsLoaded = poppinsStyle.fontFamily.includes('Poppins');
          testResults.poppinsLoaded = poppinsLoaded;

          document.getElementById('poppins-result').innerHTML = poppinsLoaded
            ? '<span style="color: green;">‚úÖ Poppins loaded successfully</span>'
            : '<span style="color: orange;">‚ö†Ô∏è Poppins fallback active</span>';

          console.info(`Poppins font ${poppinsLoaded ? 'loaded' : 'failed to load'}`);
          document.body.removeChild(testPoppins);

          // Test Font Awesome
          const testFA = document.createElement('div');
          testFA.className = 'fas fa-users';
          testFA.style.fontFamily = 'Font Awesome 6 Free';
          testFA.style.position = 'absolute';
          testFA.style.left = '-9999px';
          document.body.appendChild(testFA);

          setTimeout(() => {
            const faStyle = window.getComputedStyle(testFA);
            const faLoaded = faStyle.fontFamily.includes('Font Awesome');
            testResults.fontAwesomeLoaded = faLoaded;

            document.getElementById('fontawesome-result').innerHTML = faLoaded
              ? '<span style="color: green;">‚úÖ Font Awesome loaded successfully</span>'
              : '<span style="color: orange;">‚ö†Ô∏è Font Awesome fallback active</span>';

            console.info(`Font Awesome ${faLoaded ? 'loaded' : 'failed to load'}`);
            document.body.removeChild(testFA);

            updateFontStatus();
          }, 100);
        }, 100);
      }

      function updateFontStatus() {
        const both = testResults.poppinsLoaded && testResults.fontAwesomeLoaded;
        const status = both ? 'All fonts loaded' : 'Some fonts using fallbacks';
        const className = both ? 'success' : 'warning';

        document.getElementById('font-status').textContent = status;
        document.getElementById('font-loading-test').classList.add(className);
      }

      function testFallbackSystem() {
        const fallbackCSS = document.getElementById('fallback-css');
        const hasFallbackClasses =
          document.body.classList.contains('external-resources-failed') ||
          document.body.classList.contains('poppins-fallback');

        testResults.fallbackEnabled = hasFallbackClasses || (fallbackCSS && !fallbackCSS.disabled);

        const details = document.getElementById('fallback-details');
        details.innerHTML = `
        <p>Body classes: ${Array.from(document.body.classList).join(', ') || 'none'}</p>
        <p>Fallback CSS enabled: ${fallbackCSS && !fallbackCSS.disabled ? 'Yes' : 'No'}</p>
      `;

        const status = testResults.fallbackEnabled
          ? 'Fallback system active'
          : 'No fallbacks needed';
        const className = testResults.fallbackEnabled ? 'warning' : 'success';

        document.getElementById('fallback-status').textContent = status;
        document.getElementById('fallback-test').classList.add(className);

        console.info(`Fallback system ${testResults.fallbackEnabled ? 'active' : 'inactive'}`);
      }

      function testErrorHandling() {
        console.info('Testing error handlers...');

        // Create a link that will fail to load
        const testLink = document.createElement('link');
        testLink.rel = 'stylesheet';
        testLink.href='https://nonexistent-domain-for-testing.com/fail.css';
        testLink.onerror = () => {
          console.info('‚úÖ Error handler triggered successfully');
          testResults.errorHandlers = true;
          document.getElementById('error-results').innerHTML =
            '<span style="color: green;">‚úÖ Error handlers working correctly</span>';
          document.getElementById('error-status').textContent = 'Passed';
          document.getElementById('error-handling-test').classList.add('success');
        };

        document.head.appendChild(testLink);

        // Remove the test link after a moment
        setTimeout(() => {
          if (testLink.parentNode) {
            testLink.parentNode.removeChild(testLink);
          }
        }, 2000);
      }

      function showConsoleMessages() {
        const output = document.getElementById('console-output');
        const messages = consoleMessages
          .map(
            (msg) => `[${msg.time.toLocaleTimeString()}] ${msg.type.toUpperCase()}: ${msg.message}`
          )
          .join('\n');

        output.textContent = messages || 'No console messages captured.';
      }

      // Run tests when page loads
      window.addEventListener('load', () => {
        console.info('üß™ Starting font loading tests...');

        setTimeout(() => {
          testIntegrity();
          testFontLoading();

          setTimeout(() => {
            testFallbackSystem();
          }, 500);
        }, 200);
      });

      // Export test function for manual verification
      window.testFontFallback = function () {
        console.log('üß™ Manual font fallback test initiated...');
        testFontLoading();
        setTimeout(testFallbackSystem, 300);
      };
    </script>
  </body>
</html>
