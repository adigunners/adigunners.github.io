<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Winner Scorecard - IIM Mumbai Fantasy League</title>
  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root{
          --primary-color:#37003c;
          --secondary-color:#00ff85;
          --background-color:#f0f2f5;
          --card-background:#fff;
          --text-color:#333;
          --heading-color:#5d2163
        }
        body{
          font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
          line-height:1.7;
          margin:0;
          background-color:var(--background-color);
          color:var(--text-color)
        }
        .container{
          max-width:1200px;
          margin:20px auto;
          background-color:transparent
        }
        header{
          background:linear-gradient(135deg,var(--primary-color),var(--heading-color));
          color:#fff;
          text-align:center;
          padding:40px 20px;
          border-radius:12px;
          box-shadow:0 8px 20px rgba(0,0,0,.15);
          margin-bottom:30px
        }
        header h1{
          margin:0;
          font-size:2.5rem;
          font-weight:700
        }
        header p{
          margin:5px 0 0;
          font-size:1.1rem;
          opacity:.9
        }
        .back-button {
          display: inline-block;
          background: rgba(255,255,255,0.2);
          color: white;
          padding: 10px 20px;
          text-decoration: none;
          border-radius: 5px;
          margin-top: 15px;
          transition: background 0.2s ease;
        }
        .back-button:hover {
          background: rgba(255,255,255,0.3);
        }
        main{padding:0}
        section{
          background-color:var(--card-background);
          padding:30px;
          margin-bottom:20px;
          border-radius:8px;
          box-shadow:0 4px 15px rgba(0,0,0,.08)
        }
        h2{
          color:var(--heading-color);
          border-bottom:2px solid #f0f2f5;
          padding-bottom:10px;
          margin-top:0;
          font-size:1.8rem
        }
        .winner-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
          background: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .winner-table th {
          background: linear-gradient(135deg, var(--primary-color), var(--heading-color));
          color: white;
          padding: 15px 12px;
          text-align: left;
          font-weight: 600;
          font-size: 0.95rem;
        }
        .winner-table td {
          padding: 15px 12px;
          border-bottom: 1px solid #f0f2f5;
          font-size: 0.9rem;
        }
        .winner-table tr:hover {
          background-color: #f8f9fa;
        }
        .winner-table tr:last-child td {
          border-bottom: none;
        }
        .player-name {
          font-weight: 600;
          color: var(--heading-color);
        }
        .prize-amount {
          font-weight: 700;
          color: var(--primary-color);
          font-size: 1.1rem;
        }
        .highlights {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
        }
        .highlight-badge {
          padding: 4px 8px;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 600;
          white-space: nowrap;
        }

        .highlight-badge.gw {
          background: var(--secondary-color);
          color: var(--primary-color);
        }

        .highlight-badge.gm {
          background: #ff6b6b;
          color: white;
        }
        .winner-loading {
          text-align: center;
          padding: 40px;
          color: #777;
          font-style: italic;
        }
        .winner-loading:after {
          content: '';
          display: block;
          margin: 10px auto;
          width: 40px;
          height: 40px;
          border: 4px solid var(--primary-color);
          border-top-color: transparent;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        .winner-error {
          text-align: center;
          padding: 40px;
          color: #d32f2f;
          background: #ffebee;
          border-radius: 8px;
          margin-top: 20px;
        }
        .stats-summary {
          display: flex;
          justify-content: space-around;
          flex-wrap: wrap;
          gap: 20px;
          margin-bottom: 30px;
        }
        .summary-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
          text-align: center;
          min-width: 150px;
        }
        .summary-number {
          font-size: 2rem;
          font-weight: 700;
          color: var(--primary-color);
          margin-bottom: 5px;
        }
        .summary-label {
          color: #777;
          font-size: 0.9rem;
        }
        footer{
          text-align:center;
          font-size:.8rem;
          color:#888;
          padding:20px
        }
        
        @media (max-width: 800px){
          .container { max-width:98vw; }
          .stats-summary { gap: 15px; }
        }
        @media (max-width: 600px){
          header h1 { font-size:1.8rem }
          section {padding:20px}
          h2{font-size:1.5rem}
          .winner-table {
            font-size: 0.8rem;
          }
          .winner-table th,
          .winner-table td {
            padding: 10px 8px;
          }
          .highlights {
            gap: 4px;
          }
          .highlight-badge {
            font-size: 0.7rem;
            padding: 3px 6px;
          }
          .stats-summary {
            flex-direction: column;
            align-items: center;
          }
          .summary-card {
            width: 100%;
            max-width: 200px;
          }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÜ Complete Winner Scorecard</h1>
            <p>IIM Mumbai Fantasy League - Season 2025-26</p>
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
        </header>
        <div class="test-section" style="display:none; border:2px dashed red; padding:10px; margin:20px; text-align:center;">
          üß™ Testing Mode Active
        </div>

        <main>
            <section>
                <h2>üìä League Statistics</h2>
                <div class="stats-summary" id="stats-summary">
                    <div class="summary-card">
                        <div class="summary-number" id="completed-gameweeks">--</div>
                        <div class="summary-label">Completed Gameweeks</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" id="total-winners">--</div>
                        <div class="summary-label">Total Winners</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" id="total-prize-money">--</div>
                        <div class="summary-label">Total Prize Money</div>
                    </div>
                </div>
            </section>

            <section>
                <h2>üèÖ Complete Winner Rankings</h2>
                <p>All players ranked by total prize money won this season.</p>
                
                <div id="winner-table-container">
                    <div class="winner-loading">Loading complete winner data...</div>
                </div>
                
                <div id="winner-last-updated" style="text-align: center; font-size: 0.93rem; color: #777; font-style: italic; margin-top: 20px;">
                    Fetching latest winner data...
                </div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2025 IIM Mumbai Fantasy League Organising Committee</p>
            <p style="font-size: 0.7rem; color: #ccc; margin-top: 5px;">Last updated: August 2025</p>
        </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadWinnerData();
        loadFPLData();
        checkTestMode();
      });

      function loadWinnerData() {
        const winnerUrl = 'winner_stats.json?cache=' + new Date().getTime();
        
        fetch(winnerUrl)
          .then(response => {
            console.log('Winner fetch response:', response);
            if (!response.ok) {
              throw new Error('Winner data fetch failed');
            }
            return response.json();
          })
          .then(data => {
            console.log('Fetched winner_stats.json:', data);
            displayWinnerTable(data.winners);
            updateStatsSummary(data.winners);
            
            // Show last updated time for winners
            const lastUpdated = new Date(data.lastUpdated);
            const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const userLocale = navigator.language || 'en-GB';
            const formattedDate = lastUpdated.toLocaleString(userLocale, {
              dateStyle: 'medium',
              timeStyle: 'short',
              timeZone: userTimeZone
            });
            
            document.getElementById('winner-last-updated').textContent =
              `Last updated: ${formattedDate} (your local time)`;
          })
          .catch(error => {
            console.error('Winner fetch error:', error);
            document.getElementById('winner-table-container').innerHTML = 
              '<div class="winner-error">Unable to load winner data. Please try again later.</div>';
          });
      }

      function displayWinnerTable(winners) {
        if (!winners || winners.length === 0) {
          document.getElementById('winner-table-container').innerHTML = 
            '<div class="winner-loading">No winner data available yet.</div>';
          return;
        }

        // Sort winners by total prize won (descending)
        const sortedWinners = winners.sort((a, b) => b.totalPrizeWon - a.totalPrizeWon);

        const tableHTML = `
          <table class="winner-table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Player</th>
                <th>Total Prize Won</th>
                <th>Highlights</th>
              </tr>
            </thead>
            <tbody>
              ${sortedWinners.map((winner, index) => `
                <tr>
                  <td style="font-weight: 600; color: var(--primary-color);">#${index + 1}</td>
                  <td class="player-name">${winner.playerName}</td>
                  <td class="prize-amount">‚Çπ${winner.totalPrizeWon.toLocaleString('en-IN')}</td>
                  <td>
                    <div class="highlights">
                      ${winner.highlights.gameWeeks > 0 ? 
                        `<span class="highlight-badge gw">${winner.highlights.gameWeeks}GW</span>` : ''}
                      ${winner.highlights.gameMonths > 0 ? 
                        `<span class="highlight-badge gm">${winner.highlights.gameMonths}GM</span>` : ''}
                      ${winner.highlights.overallRank ? 
                        `<span class="highlight-badge">Rank ${winner.highlights.overallRank}</span>` : ''}
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;

        document.getElementById('winner-table-container').innerHTML = tableHTML;
      }

      function loadFPLData() {
        const fplApiUrl = 'https://fantasy.premierleague.com/api/bootstrap-static/';
        
        fetch(fplApiUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error('FPL API fetch failed');
            }
            return response.json();
          })
          .then(data => {
            // Count completed gameweeks (finished: true)
            const completedGameweeks = data.events.filter(event => event.finished === true).length;
            document.getElementById('completed-gameweeks').textContent = completedGameweeks;
          })
          .catch(error => {
            console.error('FPL API fetch error:', error);
            document.getElementById('completed-gameweeks').textContent = '--';
          });
      }

      function updateStatsSummary(winners) {
        if (!winners || winners.length === 0) return;

        const totalWinners = winners.length;
        const totalPrizeMoney = winners.reduce((sum, winner) => sum + winner.totalPrizeWon, 0);

        document.getElementById('total-winners').textContent = totalWinners;
        document.getElementById('total-prize-money').textContent = '‚Çπ' + totalPrizeMoney.toLocaleString('en-IN');
      }

      function checkTestMode() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('test') === 'true') {
          console.log('üß™ Test mode activated!');
          const section = document.querySelector('.test-section');
          if (section) section.style.display = 'block';
        }
      }
    </script>
</body>
</html> 